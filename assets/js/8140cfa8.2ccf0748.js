"use strict";(self.webpackChunkdocumentation=self.webpackChunkdocumentation||[]).push([[5734],{3045:(e,t,s)=>{s.r(t),s.d(t,{assets:()=>d,contentTitle:()=>o,default:()=>h,frontMatter:()=>r,metadata:()=>l,toc:()=>a});const l=JSON.parse('{"id":"contribute/development-guide/publishing","title":"Publishing","description":"Github actions","source":"@site/docs/contribute/development-guide/05-publishing.md","sourceDirName":"contribute/development-guide","slug":"/contribute/development-guide/publishing","permalink":"/template-fastapi-react/docs/contribute/development-guide/publishing","draft":false,"unlisted":false,"editUrl":"https://github.com/equinor/template-fastapi-react/tree/main/documentation/docs/contribute/development-guide/05-publishing.md","tags":[],"version":"current","sidebarPosition":5,"frontMatter":{},"sidebar":"contribute","previous":{"title":"Upgrading","permalink":"/template-fastapi-react/docs/contribute/development-guide/upgrading"},"next":{"title":"Documentation","permalink":"/template-fastapi-react/docs/contribute/documentation"}}');var i=s(4848),n=s(8453);const r={},o="Publishing",d={},a=[{value:"Github actions",id:"github-actions",level:2},{value:"Workflows",id:"workflows",level:3},{value:"Reusable workflows",id:"reusable-workflows",level:4},{value:"Changelogs",id:"changelogs",level:2},{value:"How to generate",id:"how-to-generate",level:3},{value:"Auto-generated",id:"auto-generated",level:4},{value:"Locally",id:"locally",level:4}];function c(e){const t={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",img:"img",li:"li",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,n.R)(),...e.components},{Details:s}=t;return s||function(e,t){throw new Error("Expected "+(t?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.header,{children:(0,i.jsx)(t.h1,{id:"publishing",children:"Publishing"})}),"\n",(0,i.jsx)(t.h2,{id:"github-actions",children:"Github actions"}),"\n",(0,i.jsxs)(t.p,{children:["We use ",(0,i.jsx)(t.a,{href:"https://docs.github.com/en/actions",children:"GitHub Actions"}),", as the ",(0,i.jsx)(t.a,{href:"https://github.com/equinor/template-fastapi-react/actions",children:"CI/CD pipeline"}),"."]}),"\n",(0,i.jsx)(t.p,{children:"GitHub Actions make it easy to automate all our software workflows. They build, test, and deploy the code right from GitHub."}),"\n",(0,i.jsxs)(t.p,{children:["All the heavy lifting is done by GitHub. GitHub will simply use the files defined in ",(0,i.jsx)(t.a,{href:"https://github.com/equinor/template-fastapi-react/tree/main/.github/workflows",children:(0,i.jsx)(t.code,{children:".github/workflows"})})," to do the setup."]}),"\n",(0,i.jsx)(t.p,{children:"We trigger the reusable workflow like this (note that the chart is slightly outdated):"}),"\n",(0,i.jsx)(t.img,{src:"https://www.plantuml.com/plantuml/png/DSr12e0m30NHVK-HTK3Fu4qaseyAQLgQkF3s8khwCSpa8JtAORb8IqpLg9s-KzJ4JA9AInTRTtXYvfa27ZvUKlJnQdfHaSDUx528usUUQOEXIs38TVso2PQ_tmq0",alt:"Github Actions"}),"\n",(0,i.jsx)(t.p,{children:"Since we are using trunk based development, all pushes to main trigger a release to a test environment."}),"\n",(0,i.jsxs)(t.p,{children:["Release to production is triggered when we merge in the auto-generated pull requests (that contains changelogs) that are created by the ",(0,i.jsx)(t.code,{children:"create-release-pr.yaml"})," Github action."]}),"\n",(0,i.jsx)(t.h3,{id:"workflows",children:"Workflows"}),"\n",(0,i.jsxs)(s,{children:[(0,i.jsx)("summary",{children:"Overview"}),(0,i.jsx)(t.p,{children:"Reusable workflows"}),(0,i.jsxs)(t.table,{children:[(0,i.jsx)(t.thead,{children:(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.th,{children:"Workflow"}),(0,i.jsx)(t.th,{children:"Job"}),(0,i.jsx)(t.th,{children:"Purpose"})]})}),(0,i.jsxs)(t.tbody,{children:[(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.a,{href:"https://github.com/equinor/template-fastapi-react/blob/main/.github/workflows/codeql-security-analysis.yaml",children:"codeql-security-analysis.yaml"})}),(0,i.jsx)(t.td,{children:"analyze"}),(0,i.jsxs)(t.td,{children:["Runs ",(0,i.jsx)(t.code,{children:"CodeQL"})," on the source code"]})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.a,{href:"https://github.com/equinor/template-fastapi-react/blob/main/.github/workflows/create-release-pr.yaml",children:"create-release-pr.yaml"})}),(0,i.jsx)(t.td,{children:"release-please"}),(0,i.jsx)(t.td,{children:"Creates a new release on GitHub"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.a,{href:"https://github.com/equinor/template-fastapi-react/blob/main/.github/workflows/deploy-to-radix.yaml",children:"deploy-to-radix.yaml"})}),(0,i.jsx)(t.td,{children:"deploy-on-radix"}),(0,i.jsx)(t.td,{children:"Deploys the services to Radix"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.a,{href:"https://github.com/equinor/template-fastapi-react/blob/main/.github/workflows/generate-changelog.yaml",children:"generate-changelog.yaml"})}),(0,i.jsx)(t.td,{children:"generate-changelog"}),(0,i.jsx)(t.td,{children:"Automatically generates changelogs based on commit messages"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.a,{href:"https://github.com/equinor/template-fastapi-react/blob/main/.github/workflows/label-importer.yaml",children:"label-importer.yaml"})}),(0,i.jsx)(t.td,{children:"labeler"}),(0,i.jsxs)(t.td,{children:["Import labels from ",(0,i.jsx)(t.code,{children:"labels.yml"})]})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.a,{href:"https://github.com/equinor/template-fastapi-react/blob/main/.github/workflows/publish-docs.yaml",children:"publish-docs.yaml"})}),(0,i.jsx)(t.td,{children:"publish-docs"}),(0,i.jsx)(t.td,{children:"Builds and publishes the latest docs to GitHub pages"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.a,{href:"https://github.com/equinor/template-fastapi-react/blob/main/.github/workflows/publish-image.yaml",children:"publish-image.yaml"})}),(0,i.jsx)(t.td,{children:"build-and-publish-web-main"}),(0,i.jsx)(t.td,{children:"Builds and publishes the Docker image for the Web (frontend)"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{}),(0,i.jsx)(t.td,{children:"build-and-publish-api-main"}),(0,i.jsx)(t.td,{children:"Builds and publishes the Docker image for the API (backend)"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{}),(0,i.jsx)(t.td,{children:"build-and-publish-nginx"}),(0,i.jsx)(t.td,{children:"Builds and publishes the Docker image for the Nginx proxy"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.a,{href:"https://github.com/equinor/template-fastapi-react/blob/main/.github/workflows/tests.yaml",children:"tests.yaml"})}),(0,i.jsx)(t.td,{children:"pre-commit"}),(0,i.jsxs)(t.td,{children:["Runs the pre-commit hooks. See ",(0,i.jsx)(t.a,{href:"/template-fastapi-react/docs/contribute/development-guide/setup#hooks",children:"Hooks"})," for details"]})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{}),(0,i.jsx)(t.td,{children:"test-api"}),(0,i.jsx)(t.td,{children:"Runs tests on the API (backend) using pytest and behave"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{}),(0,i.jsx)(t.td,{children:"test-web"}),(0,i.jsx)(t.td,{children:"Runs tests on the Web (frontend)"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{}),(0,i.jsx)(t.td,{children:"test-docs"}),(0,i.jsx)(t.td,{children:"Checks that the doc pages build without errors"})]})]})]}),(0,i.jsx)(t.p,{children:"Triggerable workflows"}),(0,i.jsxs)(t.table,{children:[(0,i.jsx)(t.thead,{children:(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.th,{children:"Workflow"}),(0,i.jsx)(t.th,{children:"Job"}),(0,i.jsx)(t.th,{children:"Purpose"})]})}),(0,i.jsxs)(t.tbody,{children:[(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.a,{href:"https://github.com/equinor/template-fastapi-react/blob/main/.github/workflows/on-pull-request.yaml",children:"on-pull-request.yaml"})}),(0,i.jsx)(t.td,{children:"codeql"}),(0,i.jsxs)(t.td,{children:["Uses the ",(0,i.jsx)(t.code,{children:"codeql-security-analysis"})," workflow"]})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{}),(0,i.jsx)(t.td,{children:"tests"}),(0,i.jsxs)(t.td,{children:["Uses the ",(0,i.jsx)(t.code,{children:"tests"})," workflow"]})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.a,{href:"https://github.com/equinor/template-fastapi-react/blob/main/.github/workflows/on-push-main-branch.yaml",children:"on-push-main-branch.yaml"})}),(0,i.jsx)(t.td,{children:"codeql"}),(0,i.jsxs)(t.td,{children:["Uses the ",(0,i.jsx)(t.code,{children:"codeql-security-analysis"})," workflow"]})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{}),(0,i.jsx)(t.td,{children:"tests"}),(0,i.jsxs)(t.td,{children:["Uses the ",(0,i.jsx)(t.code,{children:"tests"})," workflow"]})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{}),(0,i.jsx)(t.td,{children:"generate-changelog"}),(0,i.jsxs)(t.td,{children:["Uses the ",(0,i.jsx)(t.code,{children:"generate-changelog"})," workflow"]})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{}),(0,i.jsx)(t.td,{children:"docs"}),(0,i.jsxs)(t.td,{children:["Uses the ",(0,i.jsx)(t.code,{children:"publish-docs"})," workflow"]})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{}),(0,i.jsx)(t.td,{children:"publish-latest"}),(0,i.jsxs)(t.td,{children:["Uses the ",(0,i.jsx)(t.code,{children:"publish-image"})," workflow to create a docker image for the ",(0,i.jsx)(t.code,{children:"test"})," environment"]})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{}),(0,i.jsx)(t.td,{children:"deploy-test"}),(0,i.jsxs)(t.td,{children:["Uses the ",(0,i.jsx)(t.code,{children:"deploy-to-radix"})," workflow to deploy to the ",(0,i.jsx)(t.code,{children:"test"})," environment"]})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{}),(0,i.jsx)(t.td,{children:"release-please"}),(0,i.jsx)(t.td,{children:"Creates a new release PR on GitHub"})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{}),(0,i.jsx)(t.td,{children:"publish-production"}),(0,i.jsxs)(t.td,{children:["Uses the ",(0,i.jsx)(t.code,{children:"publish-image"})," workflow to create a docker image for the ",(0,i.jsx)(t.code,{children:"prod"})," environment"]})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{}),(0,i.jsx)(t.td,{children:"deploy-prod"}),(0,i.jsxs)(t.td,{children:["Uses the ",(0,i.jsx)(t.code,{children:"deploy-to-radix"})," workflow to deploy to the ",(0,i.jsx)(t.code,{children:"prod"})," environment"]})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.a,{href:"https://github.com/equinor/template-fastapi-react/blob/main/.github/workflows/on-weekly.yaml",children:"on-weekly.yaml"})}),(0,i.jsx)(t.td,{children:"codeql"}),(0,i.jsxs)(t.td,{children:["Uses the ",(0,i.jsx)(t.code,{children:"codeql-security-analysis"})," workflow"]})]})]})]})]}),"\n",(0,i.jsx)(t.h4,{id:"reusable-workflows",children:"Reusable workflows"}),"\n",(0,i.jsxs)(t.p,{children:["A reusable workflow is just like any GitHub Actions workflow with one key difference - it includes a ",(0,i.jsx)(t.code,{children:"workflow_call"})," trigger."]}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsxs)(t.p,{children:["The ",(0,i.jsx)(t.a,{href:"https://github.com/equinor/template-fastapi-react/blob/main/.github/workflows/create-release-pr.yaml",children:(0,i.jsx)(t.code,{children:"create-release-pr.yaml"})})," workflow will automatically create a pull request with an auto-generated changelog. It also bumps the version code (using semantic versioning, depending on the types of commits) and create a tagged release that can be used to deploy to production."]}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsxs)(t.p,{children:["The ",(0,i.jsx)(t.a,{href:"https://github.com/equinor/template-fastapi-react/blob/main/.github/workflows/tests.yml",children:(0,i.jsx)(t.code,{children:"tests.yaml"})})," workflow will automatically run all types of tests."]}),"\n"]}),"\n",(0,i.jsxs)(t.li,{children:["\n",(0,i.jsxs)(t.p,{children:["The ",(0,i.jsx)(t.a,{href:"https://github.com/equinor/template-fastapi-react/blob/main/.github/workflows/publish-docs.yml",children:(0,i.jsx)(t.code,{children:"publish-docs.yaml"})})," workflow will build the documentation. Then it will deploy the documentation (placed in the site folder) to GitHub Pages."]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(t.h2,{id:"changelogs",children:"Changelogs"}),"\n",(0,i.jsxs)(t.p,{children:["We auto-generate changelogs by following the ",(0,i.jsx)(t.a,{href:"https://www.conventionalcommits.org/en/v1.0.0/",children:"conventional commits"})," specification."]}),"\n",(0,i.jsx)(t.h3,{id:"how-to-generate",children:"How to generate"}),"\n",(0,i.jsx)(t.h4,{id:"auto-generated",children:"Auto-generated"}),"\n",(0,i.jsxs)(t.p,{children:["The Github action ",(0,i.jsx)(t.code,{children:"release-please.yaml"})," is a workflow that will automatically create a pull request with an auto-generated changelog every time code is pushed to the main branch."]}),"\n",(0,i.jsx)(t.h4,{id:"locally",children:"Locally"}),"\n",(0,i.jsx)(t.p,{children:"Sometimes it is nice to generate the changelogs locally for testing."}),"\n",(0,i.jsxs)(t.p,{children:["It is possible to use ",(0,i.jsx)(t.a,{href:"https://github.com/nektos/act",children:"act"})," to run Github actions locally."]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-shell",children:"act -j release-please -s GITHUB_TOKEN=<GITHUB_TOKEN>\n"})}),"\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.code,{children:"GITHUB_TOKEN"}),": Log in to GitHub and generate a personal access token (PaT) from ",(0,i.jsx)(t.code,{children:"Personal settings -> Developer settings -> Personal access tokens"}),"."]})]})}function h(e={}){const{wrapper:t}={...(0,n.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},8453:(e,t,s)=>{s.d(t,{R:()=>r,x:()=>o});var l=s(6540);const i={},n=l.createContext(i);function r(e){const t=l.useContext(n);return l.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),l.createElement(n.Provider,{value:t},e.children)}}}]);