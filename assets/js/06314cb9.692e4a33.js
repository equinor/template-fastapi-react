"use strict";(self.webpackChunkdocumentation=self.webpackChunkdocumentation||[]).push([[265],{8453:(e,t,n)=>{n.d(t,{R:()=>o,x:()=>a});var i=n(6540);const s={},r=i.createContext(s);function o(e){const t=i.useContext(r);return i.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),i.createElement(r.Provider,{value:t},e.children)}},8814:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>a,default:()=>l,frontMatter:()=>o,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"contribute/development-guide/coding/extending-the-api/adding-features/securing-endpoints","title":"Securing endpoints","description":"The REST API (i.e. python FastAPI server) has access to, and is responsible for serving, data that could be private. Therefore we need to validate that the request is coming from an authenticated client.","source":"@site/docs/contribute/development-guide/coding/extending-the-api/adding-features/03-securing-endpoints.md","sourceDirName":"contribute/development-guide/coding/extending-the-api/adding-features","slug":"/contribute/development-guide/coding/extending-the-api/adding-features/securing-endpoints","permalink":"/template-fastapi-react/docs/contribute/development-guide/coding/extending-the-api/adding-features/securing-endpoints","draft":false,"unlisted":false,"editUrl":"https://github.com/equinor/template-fastapi-react/tree/main/documentation/docs/contribute/development-guide/coding/extending-the-api/adding-features/03-securing-endpoints.md","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"sidebar_position":4},"sidebar":"contribute","previous":{"title":"Use cases","permalink":"/template-fastapi-react/docs/contribute/development-guide/coding/extending-the-api/adding-features/use-cases"},"next":{"title":"Generate API clients","permalink":"/template-fastapi-react/docs/contribute/development-guide/coding/generate-api-clients"}}');var s=n(4848),r=n(8453);const o={sidebar_position:4},a="Securing endpoints",d={},c=[];function u(e){const t={a:"a",code:"code",h1:"h1",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.header,{children:(0,s.jsx)(t.h1,{id:"securing-endpoints",children:"Securing endpoints"})}),"\n",(0,s.jsx)(t.p,{children:"The REST API (i.e. python FastAPI server) has access to, and is responsible for serving, data that could be private. Therefore we need to validate that the request is coming from an authenticated client."}),"\n",(0,s.jsx)(t.p,{children:"We do that in these steps;"}),"\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsx)(t.li,{children:"Require a JWT on each request"}),"\n",(0,s.jsx)(t.li,{children:"Fetch the RSA public keys from the authentication server."}),"\n",(0,s.jsx)(t.li,{children:"Validate the JWT signature with the auth server's public key"}),"\n"]}),"\n",(0,s.jsxs)(t.p,{children:["FastAPI has system called ",(0,s.jsx)(t.a,{href:"https://fastapi.tiangolo.com/tutorial/dependencies",children:(0,s.jsx)(t.strong,{children:"dependencies"})})," that is well suited for running a specific function before every request."]}),"\n",(0,s.jsx)(t.p,{children:"Here is an example;"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-python",children:"routes = APIRouter()\napp = FastAPI(title=\"Awesome Boilerplate\")  # Create the FastAPI app\napp.include_router(routes)  # Add a route/controller to the app\n# Add the 'auth_with_jwt()' function as a dependency\n# This function will do the actual JWT validation with step 2 and 3\napp.include_router(routes, dependencies=[Security(auth_with_jwt)])\n"})}),"\n",(0,s.jsx)(t.p,{children:"That's it! Now every route added like this will require a successful JWT validation before the request will be processed."}),"\n",(0,s.jsxs)(t.p,{children:["Dependencies can also return values, useful if you need to do some kind of ",(0,s.jsx)(t.strong,{children:"authorization"}),".\nHere is one example;"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-python",children:'@router.delete("/{id}", operation_id="delete-report")\ndef delete_report(id: str, user: User = Depends(auth_with_jwt)):\n    if has_permission(user):\n      delete_report(id)\n      return "OK"\n    else:\n      return PlainTextResponse("Permission denied", status_code=402)\n'})})]})}function l(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(u,{...e})}):u(e)}}}]);